<html>
  <head>
    <meta charset="utf-8"/>
    <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.6/firebase-auth.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.js"></script>
    {% block scripts %}
    {% endblock %}
    <title>Smart Control System</title>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.1.1/firebaseui.css" />
    {% if default %}
      <link type="text/css" rel="stylesheet" href="/static/build/css/custom-auth.css">
    {% else %}
      <link type="text/css" rel="stylesheet" href="/static/build/css/custom-auth-1.css">
    {% endif %}
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />
    {% block styles %}
    {% endblock %}
    {% if firebase_auth.api_key %}
      <script>
        var app = firebase.initializeApp({
          apiKey: "{{ firebase_auth.api_key }}",
          authDomain: "{{ firebase_auth.auth_domain }}",
          databaseURL: "https://{{ firebase_auth.project_id }}.firebaseio.com",
          storageBucket: "{{ firebase_auth.project_id }}.appspot.com",
          projectId: "{{ firebase_auth.project_id }}"
        });
        app.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)
          .then(function() {
              var ui = new firebaseui.auth.AuthUI(app.auth());
              ui.start("#firebaseui-auth-container", {
                queryParameterForSignInSuccessUrl: "next",
                signInOptions: [ {{ firebase_auth.provider_ids }} ],
                credentialHelper: firebaseui.auth.CredentialHelper.NONE,
                callbacks: {
                  signInSuccess: function(user, credential, redirectUrl) {
                    user.getIdToken().then(function(token) {
                      var xhr = new XMLHttpRequest();
                      xhr.open("POST", "{{ firebase_auth.url_for('sign_in') }}", true);
                      xhr.setRequestHeader("Content-Type", "application/jwt");
                      xhr.onreadystatechange = function() {
                        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
                          window.location.replace(redirectUrl || "{{ referrer }}" || "{{ request.url_root }}");
                        }
                      };
                      xhr.send(token);
                    });
                    return false;
                  }
                }
              });
          })
      </script>
    {% endif %}
  </head>

  <body>
    {% block header %}
    {% endblock %}
      <div id="firebaseui-auth-container" class="auth-content">
        <div class="top-container">
          <div class="logo-container">
              <img class="logo" src="{{ logo_uri }}" />
          </div>
        </div>
        <div class="header-container">
          <div class="messege-container">
          </div>
        </div>
      </div>
    {% block footer %}
    {% endblock %}
  </body>
</html>
