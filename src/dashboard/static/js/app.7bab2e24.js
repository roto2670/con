(function(e){function t(t){for(var i,n,r=t[0],c=t[1],d=t[2],l=0,m=[];l<r.length;l++)n=r[l],o[n]&&m.push(o[n][0]),o[n]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(e[i]=c[i]);h&&h(t);while(m.length)m.shift()();return a.push.apply(a,d||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],i=!0,r=1;r<s.length;r++){var c=s[r];0!==o[c]&&(i=!1)}i&&(a.splice(t--,1),e=n(n.s=s[0]))}return e}var i={},o={app:0},a=[];function n(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=i,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=t,r=r.slice();for(var d=0;d<r.length;d++)t(r[d]);var h=c;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var i=s("64a9"),o=s.n(i);o.a},"1d68":function(e,t,s){},"54d9":function(e,t,s){"use strict";var i=s("b347"),o=s.n(i);o.a},"56d7":function(e,t,s){"use strict";s.r(t);var i={};s.r(i),s.d(i,"setHubLocation",function(){return b}),s.d(i,"getInfo",function(){return p}),s.d(i,"getHubs",function(){return v}),s.d(i,"getHubListConnectedToGadget",function(){return k}),s.d(i,"getBeacons",function(){return w}),s.d(i,"getDetectBeaconList",function(){return f}),s.d(i,"getGadgets",function(){return I}),s.d(i,"getGadget",function(){return E}),s.d(i,"getMapFiles",function(){return y}),s.d(i,"getBeaconImg",function(){return B}),s.d(i,"postMapFile",function(){return W});var o={};s.r(o),s.d(o,"BeaconDetector",function(){return C});var a=s("2b0e"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"locationTracking"}},[s("Top"),s("Map")],1)},r=[],c=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.isEmptyUrl?s("div",{attrs:{id:e.id}}):e._e()},d=[],h=s("ec60"),l=s("bc3a"),m=s.n(l);const g="https://c2.prota.space",u="",b=(e,t,s)=>{m.a.post(u+"/dash/hubs/location",{hub:e},{headers:{"Content-Type":"application/json"}}).then(e=>{}).catch(e=>{console.log("FAILURE!!",e)})},p=(e,t)=>{m()({url:u+"/dash/info",method:"GET",responseType:"text"}).then(t=>{t.data?e(t.data):console.log("File is not exist")})},v=(e,t)=>{var s=[];m()({url:u+"/dash/scanner/list",method:"GET",responseType:"text"}).then(t=>{t.data?(s=t.data,e(s)):console.log("File is not exist")})},k=(e,t,s)=>{let i={};m()({url:u+"/dash/hubs/detected/"+e,method:"GET",responseType:"text"}).then(e=>{let s=e.data;s&&_.isArray(s.data)?(i=s,t(i)):console.log("fail to load connectedGadget")})},w=(e,t,s)=>{var i=[];m()({url:u+"/dash/beacons/list/"+e,method:"GET",responseType:"text"}).then(e=>{e.data?(i=e.data,t(i)):console.log("File is not exist")})},f=(e,t,s)=>{let i={};m()({url:u+"/dash/beacons/detected/"+e,method:"GET",responseType:"text"}).then(e=>{let o=e.data;o&&_.isArray(o.data)?(i=o.data,t(i)):s()})},I=(e,t,s)=>{let i=[];F(e,i,()=>{t(i)})},E=(e,t,s)=>{m()({url:u+"/dash/beacons/"+e,method:"GET",responseType:"text"}).then(i=>{i.data?t(i.data):s(`Failed to get gadget, id: ${e}`)})},y=(e,t)=>{m()({url:u+"/dashboard/location/view",method:"GET",responseType:"text"}).then(t=>{t.data?(console.log("Success to Get map image file"),e(window.location.protocol+"//"+window.location.host+t.data)):console.log("Sorry, Img file does not exist")})},B=(e,t,s)=>{var i=g+"/mib/v1/sense/"+e;m()({method:"GET",headers:{},url:i}).then(e=>{e&&e.data?t(e.data.v.img_url):(console.log("Failed to get value in storage ",error),s(error))})},W=(e,t,s)=>{let i=new FormData;e&&(i.append("file",e),m.a.post(u+"/dashboard/location/upload",i,{headers:{"Content-Type":"multiart/form-data"}}).then(e=>{console.log("Success to Upload map image file"),t("http://"+window.location.host+e.data)}).catch(e=>{console.log("Fail to Upload map image file")}))};function F(e,t,s){let i=e.shift();i?E(i,i=>{t.push(i),F(e,t,s)},()=>{F(e,t,s)}):s()}const M=6e4;let H=null;class C{constructor(e,t){if(H)return H;this._timers=[],this.hubIds=[],this.isRunning=!1,this._vm=e,this._detectedCallback=t||function(){},H=this}start(){this.isRunning&&(this.isRunning=!0),this._timers.push(setInterval(()=>{this._refreshBeacons()},M)),console.info("Beacon detector started")}stop(){this._clearTimer(),this.isRunning=!1,console.info("Beacon detector stopped")}_refreshBeacons(e,t){let s=this._vm.$store.getters.getHubsWhichIsInMap,i=0,o=0;_.forEach(s,e=>{1===e.view&&o++}),_.isEmpty(s)||(this._vm.$store.commit("removeGadgets"),p(e=>{w(e.product_id,e=>{this._vm.$store.commit("addDetectedGadget",e),_.forEach(s,e=>{1===e.view&&f(e.id,e=>{this._vm.$store.commit("addDetectedHubGadget",e),i==o-1?this._detectedCallback(console.debug("Success to update")):i++},e=>{t(e)})})},e=>{t(e)})},e=>{t(e)}))}_clearTimer(){this._.forEach(this._timers,e=>{try{clearInterval(e)}catch(error){console.warn("Failed to clear detector timer.",error)}}),this._timers=[]}}var L={methods:{isNumber:e=>!_.isNaN(e)&&_.isNumber(e)}},T={name:"Map",data(){return{id:"map",map:null,point:null,url:"",zoomLv:"",layer:"",hubLayer:"",workerLayer:"",camLayer:"",modalLayer:"",ipcam:"",ipcams:[],contextCoordinate:null,infoWindow:null,selectFilteredBeacons:["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"],bcns:{},bcnsData:{},hubsData:{},options:{items:[]},markerMap:{hubs:{},gadgets:{},cams:{}}}},methods:{initloadMap(){this.services.getMapFiles(e=>{this.map=new h["c"](this.id,{center:[90,50],zoom:6,maxZoom:9,minZoom:4,maxExtent:new h["a"](5,5,170,80),zoomAnimation:!1,zoomInCenter:!0,panAnimation:!1,dragRotate:!1,dragPitch:!1,drgaRotatePitch:!1,touchGesture:!1,touchZoom:!1,touchRotate:!1,touchPitch:!1,touchZoomRotate:!1,doubleClickZoom:!1,baseLayer:new h["b"]("base",[{url:e,extent:[0,0,180,85],opactiy:1}],{opactiy:1})}),this.layer=new h["e"]("vector").addTo(this.map),this.hubLayer=new h["e"]("vector1").addTo(this.map),this.workerLayer=new h["e"]("vector2").addTo(this.map),this.camLayer=new h["e"]("vector3").addTo(this.map),this.initContextMenu(),this.loadHubs(),this.initBeaconLocationHandler()})},initBeaconLocationHandler(e,t){this.beaconDetector=new C(this,e=>{const s=this.$store.getters.getHubsWhichIsInMap;if(_.isEmpty(s))console.warn("There is no hub id, so we cannot update hub data");else{let e={};this._.forEach(s,t=>{e[t.id]=this.$store.getters.getHub(t.id),this.removeGadgetMarkersWhenHubIsMoved(t.id)}),this.hasSameGadget(t=>{this._.forEach(e,(e,t)=>{this.drawWorkers(t,e.custom.map_location)})},e=>{t(e)})}}),this.beaconDetector.start()},initContextMenu(){this.contextMenuOption={items:[{item:"Add Scanner",click:this.handleAddHub}]},this.contextMenu=this.map.setMenu(this.contextMenuOption).openMenu(),this.map.closeMenu(),this.map.on("contextmenu",e=>{this.contextCoordinate=e.coordinate,this.map.openMenu(e.coordinate)})},loadHubs(){console.debug("Try load hubs"),this.services.getInfo(e=>{this.services.getBeacons(e.product_id,e=>{this.$store.commit("addDetectedGadget",e),this._loadHubs()})})},_loadHubs(){this.services.getHubs(e=>{this.$store.commit("addHubs",e);const t=this.$store.getters.getHubs;this._.forEach(t,e=>{_.isEmpty(e.custom)||this.drawHub(e.id,e.custom.map_location)})})},loadGadgets(e,t,s){this.services.getDetectBeaconList(e,e=>{this.$store.commit("addDetectedHubGadget",e),this.hasSameGadget(t)},e=>{s(e)})},handleAddHub(e){this.showhubList(e=>{this.map.closeMenu(e),this.drawHub(e,this.contextCoordinate)})},showhubList(e){this.map.closeMenu(),this.services.getHubs(t=>{if(this.$store.commit("addHubs",t),this.options.items=[],this._.isEmpty(t)){const e={item:"No Scanner"};this.options.items.push(e)}else{const s=new h["d"]([this.contextCoordinate.x,this.contextCoordinate.y]).addTo(this.hubLayer);if(s.hide(),this._.forEach(t,(s,i)=>{if(!this._.has(this.markerMap.hubs,s.id))if(s.custom&&s.custom.map_location)console.debug(`The ${s.name} hub has location data. so skip`);else{const o={item:s.name,click:()=>{e(s.id)}};t.length-i>1?this.options.items.push(o,"-"):this.options.items.push(o)}}),this._.isEmpty(this.options.items)){const e={item:"No Scanner",click:()=>{}};this.options.items.push(e)}s.setMenu(this.options).openMenu()}},function(e){console.warn("Failed to load hub list.")})},drawHubs(e){this._.isArray(e)?this._.forEach(e,function(e){this.drawHub(e.id,e.coordinate)}):console.warn("Failed to draw hubs by given id is empty or null.")},drawHub(e,t){console.debug("Try draw hub, id: ",e);let s=null;this.zoomLv=this.map.getZoom()/8*50,s=new h["d"]([t.x,t.y],{symbol:{markerFile:this.BASE_URI+"icon-hub-tab.svg",markerWidth:this.zoomLv,markerHeight:this.zoomLv}}).addTo(this.hubLayer),s.on("click",()=>{this.showHubInfoWindow(e,s)}),this.markerMap.hubs[e]=s,this._updateHubLocation(e,t.x,t.y),this.$store.commit("HubIsInMap",e),this.loadGadgets(e,()=>{this.drawWorkers(e,t),s.on("dragstart draaging dragend",t=>{var i=document.getElementsByClassName("hub-move-button")[0].innerHTML,o=i.replace("Move","SetLocation");document.getElementsByClassName("hub-move-button")[0].innerHTML=o,document.getElementsByClassName("hub-move-button")[0].onclick=(()=>{s.closeInfoWindow(),s.config("draggable",!1),this.removeGadgetMarkersWhenHubIsMoved(e),this._updateHubLocation(e,t.coordinate.x,t.coordinate.y),this.loadGadgets(e,()=>{this.drawWorkers(e,s._coordinates)})})})},e=>{console.log("load gadgets failed",e)}),this.map.on("zoomend",e=>{this.zoomLv=this.map.getZoom()/8*50,s.updateSymbol({markerWidth:this.zoomLv,markerHeight:this.zoomLv})})},removeHubMarker(e){let t=this.markerMap.hubs[e];if(this._.isEmpty(t))console.warn(`Failed to remove hub marker, cannot find marker by given id: ${e}`);else{let s=this.$store.getters.getHub(e);this._.isEmpty(s)?console.warn(`Failed to clear hub location, cannot found hub model by given id: ${e}`):(delete s.custom.map_location,this.services.setHubLocation(s),console.log("success to remove hubmarker")),this.$store.commit("HubIsNotInMap",e),t.remove()}this.removeGadgetMarkersWhenHubIsMoved(e);let s=this.$store.getters.getHubsWhichIsInMap;this._.forEach(s,t=>{1===t.view&&this.loadGadgets(e,()=>{this.drawWorkers(t.id,this.markerMap.hubs[t.id]._coordinates)})}),delete this.markerMap.hubs[e]},removeGadgetMarkersWhenHubIsMoved(e){let t=this.markerMap.gadgets[e];this._.isEmpty(t)||this._.forEach(t,t=>{t.remove(),this.markerMap.gadgets[e]={}}),delete this.markerMap.gadgets[e]},removeGadgetMarker(e){this._.isEmpty(e)||e.remove()},showHubInfoWindow(e,t){let s="",i=null,o={};const a=this.$store.getters.getBeaconWithHubs(e),n=this.$store.getters.getHub(e);this._.isEmpty(this.infoWindow)||this.infoWindow.remove(),this._.isEmpty(a)?(s+="<li>Theres no hub to load</li>",i+=0):this._.forEach(a,e=>{if(!o[e.gid]){o[e.gid]={};var t=this.$store.getters.getdetectedGadgetName(e.gid);s+=`<li>${t}</li>`}i=this._.keys(o).length}),t.setInfoWindow({content:'<ul class="worker_menu"><div class="worker"><div class="workerId"><div class="workerkey">SCANNER</div><div class="hubInfo" title="'+n.name+'">'+n.name+'</div></div><div class="workerCount"><div class="workerkey">WORKER</div>'+i+'</div><div class="movebtn"><button class="hub-move-button">Move</button></div><div class="removebtn"><button class="hub-remove-button">Remove</button></div></div><ul class="workerInfo">'+s+"</ul></ul>",width:350}),t.openInfoWindow(),document.getElementsByClassName("hub-move-button")[0].onclick=(()=>{var e=document.getElementsByClassName("hub-move-button")[0].innerHTML,s=e.replace("Move","SetLocation");document.getElementsByClassName("hub-move-button")[0].innerHTML=s,t.config("draggable",!0)}),document.getElementsByClassName("hub-remove-button")[0].onclick=(()=>{this.removeHubMarker(e)}),document.getElementsByClassName("maptalks-close")[0].onclick=(()=>{t.config("draggable",!1)})},drawWorkers(e,t){let s=this._.values(this.$store.getters.getdetectedGadgetList),i=1;this.zoomLv=this.map.getZoom()/8*50,this._.forEach(s,(s,o)=>{let a=null;if(this._.includes(s.hubIdList,e)&&!this._.isEmpty(s.custom)){1===s.view&&this.removeGadgetMarker(this.bcnsData[s.gid].marker,()=>{}),_.isEmpty(s.tags)?(a=new h["d"]([s.custom.x,s.custom.y],{symbol:{markerFile:this.BASE_URI+"icon-alert-tab.svg",markerWidth:this.zoomLv,markerHeight:this.zoomLv}}).addTo(this.workerLayer),a.on("click",()=>{this.showGadgetInFoWindow(e,s,this.bcns[o])})):(a=new h["d"]([s.custom.x,s.custom.y],{symbol:{markerFile:this.BASE_URI+`icon-worker${s.tags}`+"-tab.svg",markerWidth:this.zoomLv,markerHeight:this.zoomLv}}).addTo(this.workerLayer),a.on("click",()=>{this.showGadgetInFoWindow(e,s,this.bcns[o])})),this.$store.commit("GadgetIsInMap",s.gid),this.bcns[o]=a,this.bcnsData[s.gid]={marker:a,tags:s.tags};let t=this.markerMap.gadgets[e];t||(t=[],this.markerMap.gadgets[e]=t),this.map.on("zoomend",e=>{this.zoomLv=this.map.getZoom()/8*50,a.updateSymbol({markerWidth:this.zoomLv,markerHeight:this.zoomLv})}),t.push(a)}else if(this._.includes(s.hubIdList,e)&&this._.isEmpty(s.custom)){1===s.view&&this.removeGadgetMarker(this.bcnsData[s.gid].marker,()=>{}),a=new h["d"]([t.x,t.y-i/10],{symbol:{markerFile:this.BASE_URI+`icon-worker${s.tags}`+"-tab.svg",markerWidth:this.zoomLv,markerHeight:this.zoomLv}}).addTo(this.workerLayer),a.on("click",()=>{this.showGadgetInFoWindow(e,s,this.bcns[o])}),this.$store.commit("GadgetIsInMap",s.gid),this.bcns[o]=a,this.bcnsData[s.gid]={marker:a,tags:s.tags};let n=this.markerMap.gadgets[e];n||(n=[],this.markerMap.gadgets[e]=n),n.push(a),i++,this.map.on("zoomend",e=>{this.zoomLv=this.map.getZoom()/8*50,a.updateSymbol({markerWidth:this.zoomLv,markerHeight:this.zoomLv})})}})},showGadgetInFoWindow(e,t,s){let i={1:"JUMBO DRILL(2B)",2:"JUMBO DRILL(3B)",3:"CHARGING CAR",4:"WHEEL LOADER",5:"DUMP TRUCK",6:"EXCAVATOR(WHEEL)",7:"EXCAVATOR(CRAWLER)",8:"SHOTCRETE MACHINE",9:"JCB",10:"CORE DRILLING MACHINE",11:"DOZER",12:"GROUTING MACHINE",13:"MAI PUMP",14:"MOBILE PRODUCTION UNIT",15:"CHARGING PUMP UNIT",16:"BUS"},o=i[this.bcnsData[t.gid].tags],a=this.$store.getters.getHub(e),n=null;this.services.getBeaconImg(t.gid,e=>{e?(n=e,this._.isEmpty(this.infoWindow)||this.infoWindow.remove(),s.setInfoWindow({content:'<div class="bcns"><div class="bcnsInfo1"><div class="bcnskey1">NAME</div><div class="bcnName1">'+t.name+'</div><div class="bcnskey1">KIND</div><div class="bcnName1" title="'+o+'">'+o+'</div><div class="scannerData">SCANNER</div><div class="scannerName" title="'+a.name+'">'+a.name+'</div></div><img class="bcnsImg1" src="'+n+'"></img></div>',width:400,bottom:11}),s.openInfoWindow()):(this._.isEmpty(this.infoWindow)||this.infoWindow.remove(),s.setInfoWindow({content:'<div class="bcns"><div class="bcnsInfo1"><div class="bcnskey1">NAME</div><div class="bcnName1">'+t.name+'</div><div class="bcnskey1">KIND</div><div class="bcnName1" title="'+o+'">'+o+'</div><div class="scannerData">SCANNER</div><div class="scannerName" title="'+a.name+'">'+a.name+'</div></div><img class="bcnsImg1" src="'+this.BASE_URI+'item.png"></img></div>',width:400,bottom:11}),s.openInfoWindow())},e=>{})},setIpcam(){this.ipcam=new h["d"]([127.113049,37.498568],{symbol:{markerFile:this.BASE_URI+"icon-ipcam.svg",markerWidth:50,markerHeight:50}}).addTo(this.layer),this.ipcam.on("click",()=>{this.setIpcamWindow()})},setIpcamWindow(){this.ipcam.setInfoWindow({content:'<div class="bcns"><div class="bcnsInfo"><div class="bcnskey">IPCAM</div></div><img class="bcnsImg" src="'+this.BASE_URI+'item.png"></img></div>',width:400}),this.ipcam.openInfoWindow()},_updateHubLocation(e,t,s){let i=this.$store.getters.getHub(e);i&&t&&s?(this._.extend(i,{custom:{map_location:{x:t,y:s}}}),this.$store.commit("addHubLocation",i),this.services.setHubLocation(i)):console.warn("Failed to update hub location, given parms cannot be null.",i,t,s)},startInterval(e,t){const s=6e4;setInterval(()=>{const t=this.$store.getters.getHub(e);this.removeGadgetMarkersWhenHubIsMoved(t.id),this._.isEmpty(t.id)?console.warn("There is no hub id, so we cannot update hub data"):(this.hasSameGadget(()=>{}),this.drawWorkers(t.id,t.custom.map_location))},s)},setGadgetLocation(e){let t={},s={},i=0,o=0,a=null;this._.forEach(e,e=>{const s=this.$store.getters.getHub(e.hid);a=e.gid,s&&!this._.isEmpty(s.custom)&&(t[e.hid]=s.custom.map_location,t[e.hid].dist=e.dist)}),this._.forEach(t,(e,t)=>{if(this.isNumber(e.dist)){let t=e.x,s=e.y;t+=Math.abs(e.dist)/200,s+=Math.abs(e.dist)/200,i+=t,o+=s}else console.warn(`There is no dist data in hubId: ${t}`)}),this._.isEmpty(t)||(this._.forEach(e,e=>{s={hid:e.hid,gid:e.gid,x:i/this._.size(t),y:o/this._.size(t)}}),this.$store.commit("addGadgetLocation",s))},hasSameGadget(e){const t=this.$store.getters.getdetectedGadgetList;let s={};this._.forEach(t,(e,t)=>{e.hubIdList.length>1&&(s[t]={},s[t]=e.hubIdList)});let i=this._.keys(s).length,o=1;0==i?e():this._.forEach(s,(t,s)=>{this.services.getHubListConnectedToGadget(s,t=>{this.setGadgetLocation(t.data),i==o?e():o++})})},setFilterdBeacons(){let e=this.$store.getters.getdetectedGadgetList;this._.isEmpty(this.selectFilteredBeacons)?this._.forEach(this.bcnsData,(t,s)=>{e[s].view=0,t.marker.hide()}):this._.forEach(this.bcnsData,(t,s)=>{this._.includes(this.selectFilteredBeacons,this._.first(t.tags))?(0===e[s].view&&(e[s].view=1,t.marker.show(),this.$store.commit("GadgetIsInMap",s)),console.log("Sucess to Show selected Gadgets")):(e[s].view=0,t.marker.hide(),this.$store.commit("GadgetIsnotInMap",s),console.log("Sucess to Hide selected Gadgets"))})},bgChangeWorkerTab(e){var t=document.getElementById("worker"+e).src,s=t.replace("icon-worker"+e+".svg","icon-worker"+e+"-tab.svg");document.getElementById("worker"+e).src=s,this._.includes(this.selectFilteredBeacons,e)||this.selectFilteredBeacons.push(e.toString()),document.getElementById("worker"+e).onclick=(()=>{this.bgChangeWorker(e)})},bgChangeWorker(e){var t=document.getElementById("worker"+e).src,s=t.replace("icon-worker"+e+"-tab.svg","icon-worker"+e+".svg");document.getElementById("worker"+e).src=s,this._.forEach(this.selectFilteredBeacons,(t,s)=>{t===e.toString()&&this.selectFilteredBeacons.splice(s,1)}),document.getElementById("worker"+e).onclick=(()=>{this.bgChangeWorkerTab(e)})},filterBeacons(){let e="",t=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"];var s=this.map.getCenter(),i={};s.y-=3,16!=this.selectFilteredBeacons.length?(e+='<div class="filter_menu"><div>',this._.forEach(t,t=>{this._.includes(this.selectFilteredBeacons,t)?e+='<img id="worker'+t+'" class="workerImg" src="'+this.BASE_URI+"icon-worker"+t+'-tab.svg">':e+='<img id="worker'+t+'" class="workerImg" src="'+this.BASE_URI+"icon-worker"+t+'.svg">'}),e+='</div><div class="controlContainer"><button id="done" class="done">OK</button><button id="reset" class="reset">Reset</button></div></div>',i={width:700,height:250,content:e},this.infoWindow=new h["f"].InfoWindow(i),this.infoWindow.addTo(this.map).show(s)):(i={width:700,height:250,autoPan:!1,autoCloseOn:!1,autoOpenOn:!1,content:'<div class="filter_menu"><div><img id="worker1" class="workerImg" src="'+this.BASE_URI+'icon-worker1-tab.svg"><img id="worker2" class="workerImg" src="'+this.BASE_URI+'icon-worker2-tab.svg"><img id="worker3" class="workerImg" src="'+this.BASE_URI+'icon-worker3-tab.svg"><img id="worker4" class="workerImg" src="'+this.BASE_URI+'icon-worker4-tab.svg"><img id="worker5" class="workerImg" src="'+this.BASE_URI+'icon-worker5-tab.svg"><img id="worker6" class="workerImg" src="'+this.BASE_URI+'icon-worker6-tab.svg"><img id="worker7" class="workerImg" src="'+this.BASE_URI+'icon-worker7-tab.svg"><img id="worker8" class="workerImg" src="'+this.BASE_URI+'icon-worker8-tab.svg"><img id="worker9" class="workerImg" src="'+this.BASE_URI+'icon-worker9-tab.svg"><img id="worker10" class="workerImg" src="'+this.BASE_URI+'icon-worker10-tab.svg"><img id="worker11" class="workerImg" src="'+this.BASE_URI+'icon-worker11-tab.svg"><img id="worker12" class="workerImg" src="'+this.BASE_URI+'icon-worker12-tab.svg"><img id="worker13" class="workerImg" src="'+this.BASE_URI+'icon-worker13-tab.svg"><img id="worker14" class="workerImg" src="'+this.BASE_URI+'icon-worker14-tab.svg"><img id="worker15" class="workerImg" src="'+this.BASE_URI+'icon-worker15-tab.svg"><img id="worker16" class="workerImg" src="'+this.BASE_URI+'icon-worker16-tab.svg"></div><div class="controlContainer"><button id="done" class="done">OK</button><button id="reset" class="reset">Reset</button></div></div>'},this.infoWindow=new h["f"].InfoWindow(i),this.infoWindow.addTo(this.map).show(s)),document.getElementsByClassName("maptalks-close")[0].onclick=(()=>{this.refilterBeacons(),this.infoWindow.remove()}),document.getElementById("done").onclick=(()=>{this.infoWindow.remove(),this.setFilterdBeacons()}),document.getElementById("reset").onclick=(()=>{this.refilterBeacons(),this.infoWindow.hide(),this.infoWindow.remove()}),document.getElementById("worker1").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"1")?this.bgChangeWorker(1,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(1,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker2").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"2")?this.bgChangeWorker(2,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(2,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker3").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"3")?this.bgChangeWorker(3,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(3,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker4").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"4")?this.bgChangeWorker(4,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(4,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker5").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"5")?this.bgChangeWorker(5,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(5,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker6").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"6")?this.bgChangeWorker(6,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(6,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker7").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"7")||this.bgChangeWorkerTab(7,this.selectFilteredBeacons,()=>{}),this.bgChangeWorker(7,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker8").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"8")?this.bgChangeWorker(8,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(8,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker9").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"9")?this.bgChangeWorker(9,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(9,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker10").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"10")?this.bgChangeWorker(10,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(10,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker11").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"11")?this.bgChangeWorker(11,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(11,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker12").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"12")?this.bgChangeWorker(12,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(12,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker13").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"13")?this.bgChangeWorker(13,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(13,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker14").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"14")?this.bgChangeWorker(14,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(14,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker15").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"15")?this.bgChangeWorker(15,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(15,this.selectFilteredBeacons,()=>{})}),document.getElementById("worker16").onclick=(()=>{this._.includes(this.selectFilteredBeacons,"16")?this.bgChangeWorker(16,this.selectFilteredBeacons,()=>{}):this.bgChangeWorkerTab(16,this.selectFilteredBeacons,()=>{})})},refilterBeacons(){this.selectFilteredBeacons=["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16"];let e=this.$store.getters.getdetectedGadgetList;this._.forEach(e,t=>{0==t.view&&this._.forEach(this.bcnsData,(s,i)=>{i===t.gid&&(e[i].view=1,s.marker.show(),this.$store.commit("GadgetIsInMap",i))})})}},computed:{isEmptyUrl(){return this._.isEmpty(this.mapUrl)}},created(){this.$emit("select-button"),q.$on("zoomIn",()=>{this.map.zoomIn(7)}),q.$on("zoomOut",()=>{this.map.zoomOut(6)}),q.$on("filter",()=>{this.filterBeacons()}),q.$on("refilter",()=>{this.refilterBeacons()})},mounted(){this.initloadMap()},mixins:[L]},G=T,R=(s("54d9"),s("2877")),S=Object(R["a"])(G,c,d,!1,null,null,null),$=S.exports,A=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"topContainer"}},[s("div",{attrs:{id:"leftContainer"}},[s("div",{attrs:{id:"zoom"}},[s("img",{attrs:{id:"clickbtnPlus",src:"static/location/imgs/icon-plus.svg"},on:{click:e.zoomIn}}),s("img",{attrs:{id:"clickbtnMinus",src:"static/location/imgs/icon-minus.svg"},on:{click:e.zoomOut}})]),s("div",{attrs:{id:"filter"}},[s("img",{attrs:{id:"clickbtnFilter",src:"static/location/imgs/icon-filter.svg"},on:{click:e.filter}})])]),s("div",{attrs:{id:"rightContainer"}},[s("div",{attrs:{id:"upload"}},[s("button",{attrs:{id:"clickbtn"},on:{click:function(t){return e.$refs.file.click()}}},[e._m(0)]),s("input",{ref:"file",attrs:{type:"file",id:"file",accept:"image/jpeg, image/png, image/gif"},on:{change:e.onFileChange}})])])])},x=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"btntitle"}},[e._v("Upload "),s("i",{staticClass:"fa fa-upload"})])}],U={name:"Top",methods:{zoomIn(){q.$emit("zoomIn")},zoomOut(){q.$emit("zoomOut")},onFileChange(e){this.file=e.target.files[0],this.submitFile()},getMapFile(e){this.services.getMapFile},submitFile(){this.services.postMapFile(this.file,e=>{window.location.reload()})},handleFileUpload(){this.file=this.$refs.file.files[0]},filter(){q.$emit("filter")}},computed:{isEmptyUrl(){return!this.url}},created(){this.getMapFile()}},N=U,z=(s("dee7"),Object(R["a"])(N,A,x,!1,null,null,null)),O=z.exports,D={components:{Map:$,Top:O},methods:{}},P=D,j=(s("034f"),Object(R["a"])(P,n,r,!1,null,null,null)),Z=j.exports,K=s("415c"),J=s.n(K),V=(s("5453"),s("2f62"));a["a"].use(V["a"]);var X=new V["a"].Store({state:{hubs:{},gadgets:{},detectedgadgets:{},forInfohubs:[],drawgadget:{},drawnHubs:{}},getters:{getHubs:e=>{return _.values(e.hubs)},getHub:e=>t=>{return e.hubs[t]},getHubsWhichIsInMap:e=>{return _.values(e.drawnHubs)},getBeaconWithHubs:e=>t=>{return e.forInfohubs[t]},getGadget:e=>(t,s)=>{return e.gadgets[t].find(e=>e.id===s)},getGadgetsWithHub:e=>{return e.gadgets},getdetectedGadgetList:e=>{return e.detectedgadgets},getdetectedGadgetName:e=>t=>{return e.detectedgadgets[t].name},getgadgetmanyhubs:e=>{let t={};return _.forEach(e.detectedgadgets,e=>{t[e.gid]={},t[e.gid]=e.hid}),t}},mutations:{addHubs(e,t){_.forEach(t,t=>{e.hubs[t.id]=t})},addHub(e,t){_.isEmpty(e.hubs[t.hub_id])&&(e.hubs[t.hub_id]=[]),e.hubs[t.hub_id].push(t.hub)},HubIsInMap(e,t){_.isEmpty(e.drawnHubs[t])&&(e.drawnHubs[t]={}),e.drawnHubs[t].id=t,e.drawnHubs[t].view=1},HubIsNotInMap(e,t){_.isEmpty(e.drawnHubs[t])&&(e.drawnHubs[t]={}),e.drawnHubs[t].id=t,e.drawnHubs[t].view=0},addDetectedGadget(e,t){_.forEach(t,t=>{e.gadgets[t.id]=t})},addDetectedHubGadget(e,t){_.forEach(t,s=>{if(_.has(e.gadgets,s.gid)){let i=e.gadgets[s.gid];_.isEmpty(e.detectedgadgets[s.gid])&&(e.detectedgadgets[s.gid]={gid:i.id,hubIdList:[],name:i.name,dist:s.dist,uuid:i.beacon_spec.uuid,major:i.beacon_spec.major,minor:i.beacon_spec.minor,custom:{},tags:i.tags,view:0,account_id:i.account_id}),e.forInfohubs[s.hid]=t,_.isEmpty(e.detectedgadgets[s.gid].hubIdList.find(e=>e===s.hid))&&e.detectedgadgets[s.gid].hubIdList.push(s.hid)}})},addGadgets(e,t){_.forEach(t,t=>{e.gadgets[t.gid]=t})},addHubLocation(e,t){const s=e.hubs[t.id];_.isEmpty(s)||(s.custom.map_location=t.custom.map_location)},addGadgetLocation(e,t){const s=e.gadgets[t.gid],i=e.detectedgadgets[t.gid];_.isEmpty(s)||_.isUndefined(i)||(s.custom=_.pick(t,["x","y"]),i.custom=_.pick(t,["x","y"]))},GadgetIsInMap(e,t){e.detectedgadgets[t]&&(e.detectedgadgets[t].view=1)},GadgetIsnotInMap(e,t){_.isEmpty(e.detectedgadgets[t])||(e.detectedgadgets[t].view=0)},removeGadgets(e){delete e.gadgets,e.gadgets={},delete e.detectedgadgets,e.detectedgadgets={}}},actions:{}});s.d(t,"EventBus",function(){return q}),a["a"].prototype.$http=m.a,a["a"].prototype.services=i,a["a"].prototype.beaconDetector=o,a["a"].prototype.BASE_URI="static/location/imgs/",a["a"].config.productionTip=!1;const q=new a["a"]({});a["a"].use(J.a),new a["a"]({store:X,render:e=>e(Z)}).$mount("#locationTracking")},"64a9":function(e,t,s){},b347:function(e,t,s){},dee7:function(e,t,s){"use strict";var i=s("1d68"),o=s.n(i);o.a}});
//# sourceMappingURL=app.7bab2e24.js.map